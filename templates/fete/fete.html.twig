{% extends 'base.html.twig' %}


    {% block stylesheets %}
    <style>
        body {
            margin: 0;
            width: 100%;
            height: 100vh;
            background: url('/images/fete.png') center/cover no-repeat;
            position: relative;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
        }

        .peluche {
            position: absolute;
            width: 150px;
            height: 150px;
            cursor: grab;
            user-select: none;
        }

        #cible {
            position: absolute;
            top: 400px;
            left: 300px;
            width: 200px; /* taille du coffre */
            height: auto;
        }

        #message {
            position: absolute;
            top: 620px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }
    </style>
    {% endblock %}


    {% block body %}
        <!-- Peluches à déplacer -->
        <img src="/images/peluche.png" id="peluche1" class="peluche" data-correct="false" style="top:50px; left:50px;">
        <img src="/images/peluche2.png" id="peluche2" class="peluche" data-correct="false" style="top:50px; left:250px;">
        <img src="/images/peluche.png" id="peluche3" class="peluche" data-correct="true" style="top:50px; left:450px;">

        <!-- Coffre : zone de drop -->
        <img src="/images/coffre.png" id="cible" alt="coffre">

        <!-- Sons -->
        <audio id="son-correct" src="/sounds/win.mp3"></audio>
        <audio id="son-incorrect" src="/sounds/lose.mp3"></audio>
    {% endblock %}

    {% block javascripts %}
    <script>
        const peluches = document.querySelectorAll('.peluche');
        const cible = document.getElementById('cible');
        const sonCorrect = document.getElementById('son-correct');
        const sonIncorrect = document.getElementById('son-incorrect');

        peluches.forEach(peluche => {
            peluche.addEventListener('mousedown', (e) => {
                let shiftX = e.clientX - peluche.getBoundingClientRect().left;
                let shiftY = e.clientY - peluche.getBoundingClientRect().top;

                peluche.style.position = 'absolute';
                peluche.style.zIndex = 1000;

                function moveAt(pageX, pageY) {
                    peluche.style.left = pageX - shiftX + 'px';
                    peluche.style.top = pageY - shiftY + 'px';
                }

                moveAt(e.pageX, e.pageY);

                function onMouseMove(e) {
                    moveAt(e.pageX, e.pageY);
                }

                document.addEventListener('mousemove', onMouseMove);

                peluche.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    peluche.onmouseup = null;

                    // Vérification collision avec le coffre
                    const pelucheRect = peluche.getBoundingClientRect();
                    const cibleRect = cible.getBoundingClientRect();

                    const overlap = !(pelucheRect.right < cibleRect.left || 
                                      pelucheRect.left > cibleRect.right || 
                                      pelucheRect.bottom < cibleRect.top || 
                                      pelucheRect.top > cibleRect.bottom);

                    if (overlap) {
                        if (peluche.dataset.correct === "true") {
                            sonCorrect.play();

                            // Centrer la peluche sur le coffre
                            peluche.style.left = (cibleRect.left + window.scrollX + (cibleRect.width - pelucheRect.width)/2) + 'px';
                            peluche.style.top = (cibleRect.top + window.scrollY + (cibleRect.height - pelucheRect.height)/2) + 'px';

                            // Changement de salle après 1 seconde
                            setTimeout(() => {
                                 window.location.assign('/inverse')
                            }, 1000);
                        } else {
                            sonIncorrect.play();
                        }
                    }
                };
            });

            peluche.ondragstart = () => false; // désactive drag HTML
        });
    </script>
    {% endblock %}

